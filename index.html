<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>マカミ占い🏯</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: #ffffff;
            min-height: 100vh;
            line-height: 1.6;
        }
        
        .container {
            max-width: 400px;
            margin: 0 auto;
            padding: 20px;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .header h1 {
            font-size: 28px;
            margin-bottom: 10px;
            background: linear-gradient(45deg, #ffd700, #ffeb3b);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .header p {
            color: #cccccc;
            font-size: 14px;
        }
        
        .card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 20px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }
        
        .fortune-result {
            text-align: center;
        }
        
        .castle-name {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 20px;
            color: #ffd700;
        }
        
        .fortune-details {
            margin-bottom: 20px;
        }
        
        .detail-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 12px;
            padding: 8px 12px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
        }
        
        .detail-label {
            font-weight: bold;
            color: #cccccc;
        }
        
        .detail-value {
            color: #ffffff;
        }
        
        .catch-phrase {
            font-size: 18px;
            font-weight: bold;
            color: #ffd700;
            margin: 20px 0 15px;
            text-align: center;
        }
        
        .description {
            color: #e0e0e0;
            font-size: 14px;
            text-align: center;
            line-height: 1.5;
        }
        
        .button-group {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-top: 20px;
        }
        
        .btn {
            padding: 15px 20px;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
            text-align: center;
        }
        
        .btn-primary {
            background: linear-gradient(45deg, #ff6b6b, #ee5a24);
            color: white;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(255, 107, 107, 0.4);
        }
        
        .btn-secondary {
            background: linear-gradient(45deg, #3742fa, #2f3542);
            color: white;
        }
        
        .btn-secondary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(55, 66, 250, 0.4);
        }
        
        .btn-outline {
            background: transparent;
            border: 2px solid #ffd700;
            color: #ffd700;
        }
        
        .btn-outline:hover {
            background: #ffd700;
            color: #1a1a2e;
        }
        
        .btn-disabled {
            background: #666;
            color: #aaa;
            cursor: not-allowed;
            border: 2px solid #666;
        }
        
        .btn-disabled:hover {
            transform: none;
            box-shadow: none;
            background: #666;
            color: #aaa;
        }
        
        .mode-selector {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .mode-btn {
            flex: 1;
            padding: 12px;
            border: 2px solid #ffd700;
            background: transparent;
            color: #ffd700;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
        }
        
        .mode-btn.active {
            background: #ffd700;
            color: #1a1a2e;
        }

        .initial-screen {
            text-align: center;
        }

        .start-btn {
            margin-top: 20px;
        }
        
        .gacha-counter {
            text-align: center;
            margin-bottom: 15px;
            padding: 10px;
            background: rgba(255, 215, 0, 0.1);
            border-radius: 10px;
            border: 1px solid rgba(255, 215, 0, 0.3);
        }
        
        .gacha-counter-text {
            color: #ffd700;
            font-size: 14px;
        }
        
        .gacha-limit-warning {
            color: #ff9999;
            font-size: 12px;
            text-align: center;
            margin-top: 10px;
            padding: 8px;
            background: rgba(255, 153, 153, 0.1);
            border-radius: 8px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🏯 マカミ占い 🏯</h1>
            <p>今日はどの城があなたを守ってくれる？</p>
        </div>
        
        <div id="app">
            <div class="card initial-screen">
                <h2 style="margin-bottom: 20px; color: #ffd700;">占いモードを選択</h2>
                <div class="mode-selector">
                    <button class="mode-btn active" onclick="setMode('daily')">今日の城</button>
                    <button class="mode-btn" onclick="setMode('random')">ランダム</button>
                </div>
                <div id="gacha-counter-display" style="display: none;">
                    <div class="gacha-counter">
                        <div class="gacha-counter-text">今日のガチャ: <span id="gacha-count">0</span>/3回</div>
                    </div>
                </div>
                <button class="btn btn-primary start-btn" onclick="startFortune()">占いを始める</button>
            </div>
        </div>
    </div>

    <script>
        // アプリの状態
        let currentMode = 'daily';
        let todaysCastle = null;
        let gachaCount = 0;

        // 200城データ（コンパクト版）
        const castleData = [
            // 日本100名城（主要な城のみ抜粋）
            {id: 1, 城名: "弘前城", 武将: "津軽為信", フード: "りんごパイ", カラー: "桜ピンク", キャッチ: "甘酸っぱさで恋も運も実る！", 説明: "津軽氏の居城。桜の名所として全国的に有名です。"},
            {id: 2, 城名: "根城", 武将: "南部師行", フード: "南部せんべい", カラー: "南部ブラウン", キャッチ: "堅実な歩みで確実に前進！", 説明: "南部氏の本拠地として栄えた中世の城館跡です。"},
            {id: 5, 城名: "仙台城", 武将: "伊達政宗", フード: "牛タン", カラー: "伊達ブルー", キャッチ: "独眼竜の勢いで一気に攻める！", 説明: "伊達政宗が築いた仙台藩の居城です。"},
            {id: 16, 城名: "江戸城", 武将: "太田道灌", フード: "江戸前寿司", カラー: "江戸紫", キャッチ: "天下の中心で大きく羽ばたく！", 説明: "徳川幕府の本城。現在の皇居です。"},
            {id: 18, 城名: "小田原城", 武将: "北条早雲", フード: "かまぼこ", カラー: "小田原ホワイト", キャッチ: "弾力のある対応で困難も乗り切る！", 説明: "後北条氏の本城。戦国時代最強の城でした。"},
            {id: 19, 城名: "武田氏館", 武将: "武田信玄", フード: "ほうとう", カラー: "甲斐ゴールド", キャッチ: "風林火山の勢いで駆け抜ける！", 説明: "武田信玄の居館。躑躅ヶ崎館とも呼ばれます。"},
            {id: 22, 城名: "上田城", 武将: "真田昌幸", フード: "くるみそば", カラー: "真田レッド", キャッチ: "知略で大軍も打ち破る！", 説明: "真田昌幸・幸村父子の居城です。"},
            {id: 24, 城名: "松本城", 武将: "石川数正", フード: "信州そば", カラー: "国宝ブラック", キャッチ: "漆黒の美しさで注目を集める！", 説明: "現存天守12城の一つ。烏城とも呼ばれます。"},
            {id: 27, 城名: "春日山城", 武将: "上杉謙信", フード: "へぎそば", カラー: "毘沙門ブルー", キャッチ: "軍神の加護で無敵状態！", 説明: "上杉謙信の居城。難攻不落の天然の要害です。"},
            {id: 30, 城名: "金沢城", 武将: "前田利家", フード: "金箔ソフト", カラー: "加賀ゴールド", キャッチ: "金箔のように輝く運気！", 説明: "加賀前田氏の居城です。"},
            {id: 31, 城名: "丸岡城", 武将: "柴田勝豊", フード: "越前おろしそば", カラー: "福井ホワイト", キャッチ: "現存最古の天守で歴史を感じる！", 説明: "現存天守12城の一つ。日本最古の天守です。"},
            {id: 34, 城名: "岐阜城", 武将: "織田信長", フード: "鮎菓子", カラー: "天下布武ゴールド", キャッチ: "信長の野望で天下統一！", 説明: "織田信長が「天下布武」を掲げた城です。"},
            {id: 36, 城名: "駿府城", 武将: "徳川家康", フード: "安倍川餅", カラー: "駿河ホワイト", キャッチ: "大御所の貫録で堂々と！", 説明: "徳川家康の隠居城です。"},
            {id: 38, 城名: "犬山城", 武将: "織田信康", フード: "きしめん", カラー: "尾張ブルー", キャッチ: "平たい麺のように幅広い人脈を！", 説明: "現存天守12城の一つです。"},
            {id: 39, 城名: "名古屋城", 武将: "徳川義直", フード: "エビフライ", カラー: "金シャチゴールド", キャッチ: "金の鯱のように輝く存在に！", 説明: "尾張徳川家の居城。金の鯱で有名です。"},
            {id: 45, 城名: "彦根城", 武将: "井伊直政", フード: "近江牛", カラー: "ひこにゃんレッド", キャッチ: "国宝級の幸運が舞い込む！", 説明: "現存天守12城の一つ。ひこにゃんの故郷です。"},
            {id: 46, 城名: "安土城", 武将: "織田信長", フード: "近江米", カラー: "信長ゴールド", キャッチ: "天主の威光で天下に名を轟かせる！", 説明: "織田信長の居城。日本初の天主を持つ城です。"},
            {id: 48, 城名: "二条城", 武将: "徳川家康", フード: "湯豆腐", カラー: "京都ベージュ", キャッチ: "雅やかな心で上品に過ごす！", 説明: "徳川家康が築城。大政奉還の舞台です。"},
            {id: 49, 城名: "大阪城", 武将: "豊臣秀吉", フード: "たこ焼き", カラー: "太閤ゴールド", キャッチ: "太閤の出世運にあやかる！", 説明: "豊臣秀吉の居城。天下統一の象徴です。"},
            {id: 54, 城名: "姫路城", 武将: "池田輝政", フード: "アーモンドトースト", カラー: "白鷺ホワイト", キャッチ: "白鷺のように優雅に舞い踊る！", 説明: "世界遺産の国宝天守。白鷺城と呼ばれます。"},
            {id: 59, 城名: "松江城", 武将: "堀尾吉晴", フード: "しじみ汁", カラー: "宍道湖ブルー", キャッチ: "現存天守の貫録で堂々と！", 説明: "現存天守12城の一つ。千鳥城とも呼ばれます。"},
            {id: 63, 城名: "備中松山城", 武将: "三村家親", フード: "きび団子", カラー: "備中ホワイト", キャッチ: "桃太郎伝説で勇気を授かる！", 説明: "現存天守12城の一つ。最も高い場所にある現存天守。"},
            {id: 68, 城名: "広島城", 武将: "毛利輝元", フード: "お好み焼き", カラー: "カープレッド", キャッチ: "何でも混ぜて新しい価値を創造！", 説明: "毛利輝元が築城。太平洋戦争で被爆しました。"},
            {id: 72, 城名: "高松城", 武将: "生駒親正", フード: "讃岐うどん", カラー: "讃岐ホワイト", キャッチ: "コシの強さで困難も乗り切る！", 説明: "生駒氏・松平氏の居城。海に面した水城です。"},
            {id: 73, 城名: "丸亀城", 武将: "生駒親正", フード: "骨付鳥", カラー: "讃岐ブラウン", キャッチ: "豪快にかぶりついて運気も上昇！", 説明: "現存天守12城の一つ。「石の城」と呼ばれます。"},
            {id: 76, 城名: "松山城", 武将: "加藤嘉明", フード: "鯛めし", カラー: "伊予オレンジ", キャッチ: "現存天守の威厳で堂々と！", 説明: "現存天守12城の一つです。"},
            {id: 78, 城名: "宇和島城", 武将: "藤堂高虎", フード: "鯛そうめん", カラー: "宇和海ピンク", キャッチ: "現存天守の気品で品格アップ！", 説明: "現存天守12城の一つ。藤堂高虎が築いた海城です。"},
            {id: 79, 城名: "高知城", 武将: "山内一豊", フード: "カツオのたたき", カラー: "土佐レッド", キャッチ: "一豊・千代夫妻の愛情で良縁成就！", 説明: "現存天守12城の一つ。山内氏土佐24万石の居城。"},
            {id: 80, 城名: "福岡城", 武将: "黒田長政", フード: "明太子", カラー: "博多レッド", キャッチ: "黒田官兵衛の知恵で難局突破！", 説明: "黒田長政が築城。筑前52万石の本拠地でした。"},
            {id: 87, 城名: "熊本城", 武将: "加藤清正", フード: "からし蓮根", カラー: "熊本レッド", キャッチ: "清正公の築城技術で不屈の精神！", 説明: "加藤清正の名城。「武者返し」の石垣で有名です。"},
            {id: 95, 城名: "首里城", 武将: "尚巴志", フード: "サーターアンダギー", カラー: "琉球レッド", キャッチ: "琉球王国の華やかさで注目の的！", 説明: "琉球王国の王宮。独特の文化を持つ沖縄の象徴。"},
            
            // 続日本100名城から主要な城を追加
            {id: 101, 城名: "志苔館", 武将: "蠣崎氏", フード: "海鮮丼", カラー: "函館ブルー", キャッチ: "海の幸で運気も満ち潮！", 説明: "蠣崎氏の居館跡。函館の歴史を物語ります。"},
            {id: 105, 城名: "白石城", 武将: "片倉景綱", フード: "白石温麺", カラー: "白石ホワイト", キャッチ: "片倉小十郎の忠義で信頼獲得！", 説明: "片倉氏の居城。伊達家の重臣の居城です。"},
            {id: 109, 城名: "米沢城", 武将: "上杉景勝", フード: "米沢牛", カラー: "上杉ゴールド", キャッチ: "上杉の義の心で人望を集める！", 説明: "上杉氏の居城。直江兼続の内政手腕でも有名。"},
            {id: 118, 城名: "忍城", 武将: "成田氏長", フード: "フライ", カラー: "行田ブラック", キャッチ: "水攻めにも負けない不屈の精神！", 説明: "成田氏の平城。石田三成の水攻めに耐え抜きました。"},
            {id: 122, 城名: "大多喜城", 武将: "本多忠勝", フード: "タケノコ", カラー: "房総グリーン", キャッチ: "本多忠勝の勇猛さで敵なし！", 説明: "本多忠勝の居城。徳川四天王の一人が治めました。"},
            {id: 126, 城名: "石垣山城", 武将: "豊臣秀吉", フード: "小田原おでん", カラー: "石垣グレー", キャッチ: "一夜城の奇策で大逆転劇！", 説明: "豊臣秀吉の一夜城。小田原攻めの本陣です。"},
            {id: 129, 城名: "龍岡城", 武将: "松平乗謨", フード: "蕎麦", カラー: "佐久グリーン", キャッチ: "日本唯一の五稜郭で特別感！", 説明: "日本に2つしかない五稜郭の一つです。"},
            {id: 137, 城名: "越前大野城", 武将: "金森長近", フード: "大野醤油", カラー: "大野ブラウン", キャッチ: "天空の城で雲海に包まれる！", 説明: "金森長近が築城。雲海に浮かぶ天空の城として人気。"},
            {id: 142, 城名: "美濃金山城", 武将: "森蘭丸", フード: "栗きんとん", カラー: "美濃ゴールド", キャッチ: "森蘭丸の美少年ぶりで人気者！", 説明: "森蘭丸の生地。織田信長の小姓として活躍しました。"},
            {id: 147, 城名: "浜松城", 武将: "徳川家康", フード: "浜松餃子", カラー: "出世ゴールド", キャッチ: "家康の出世城で大成功！", 説明: "徳川家康の居城。天下人への第一歩を踏み出した城。"},
            {id: 151, 城名: "津城", 武将: "藤堂高虎", フード: "伊勢うどん", カラー: "津ブラウン", キャッチ: "築城の名手の技術で完璧！", 説明: "藤堂高虎の居城。築城の名手が手がけた海城。"},
            {id: 157, 城名: "福知山城", 武将: "明智光秀", フード: "丹波黒豆", カラー: "福知山ブラック", キャッチ: "明智光秀の内政手腕で民政向上！", 説明: "明智光秀の居城。光秀の善政で領民に愛されました。"},
            {id: 165, 城名: "米子城", 武将: "吉川広家", フード: "境港の蟹", カラー: "米子レッド", キャッチ: "中海の水運で経済繁栄！", 説明: "吉川広家の居城。中海に面した海城として栄えました。"},
            {id: 170, 城名: "勝瑞城", 武将: "細川成之", フード: "阿波藍", カラー: "勝瑞ブルー", キャッチ: "阿波藍のように深い知恵で成功！", 説明: "細川氏の居城。阿波守護の本拠として栄えました。"},
            {id: 175, 城名: "岡豊城", 武将: "長宗我部元親", フード: "文旦", カラー: "土佐オレンジ", キャッチ: "四国統一の野望で大飛躍！", 説明: "長宗我部元親の居城。四国統一の拠点となりました。"},
            {id: 176, 城名: "小倉城", 武将: "細川忠興", フード: "小倉牛", カラー: "小倉ブラック", キャッチ: "細川ガラシャの美貌で魅力UP！", 説明: "細川忠興の居城。九州の玄関口として重要でした。"},
            {id: 183, 城名: "原城", 武将: "有馬晴信", フード: "島原そうめん", カラー: "原ホワイト", キャッチ: "島原の乱の悲劇を乗り越える！", 説明: "島原の乱の舞台。キリシタン一揆の最後の砦。"},
            {id: 186, 城名: "中津城", 武将: "黒田孝高", フード: "中津からあげ", カラー: "中津ゴールド", キャッチ: "黒田官兵衛の智謀で天下取り！", 説明: "黒田孝高の居城。九州平定の拠点となりました。"},
            {id: 194, 城名: "座喜味城", 武将: "護佐丸", フード: "ゴーヤーチャンプルー", カラー: "座喜味グリーン", キャッチ: "護佐丸の築城技術で完璧な城！", 説明: "護佐丸築城のグスク。美しい曲線美で有名。"},
            {id: 195, 城名: "勝連城", 武将: "阿麻和利", フード: "サーターアンダギー", カラー: "勝連ゴールド", キャッチ: "琉球の英雄の野望で大志！", 説明: "阿麻和利のグスク。琉球王国に反旗を翻した英雄の城。"},
        ];

        // ガチャ回数管理
        function canDrawGacha() {
            return gachaCount < 3;
        }

        function updateGachaDisplay() {
            const countElement = document.getElementById('gacha-count');
            if (countElement) {
                countElement.textContent = gachaCount;
            }
        }

        // モード設定
        function setMode(mode) {
            currentMode = mode;
            document.querySelectorAll('.mode-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            const gachaDisplay = document.getElementById('gacha-counter-display');
            if (mode === 'random') {
                gachaDisplay.style.display = 'block';
                updateGachaDisplay();
            } else {
                gachaDisplay.style.display = 'none';
            }
        }

        // 占い開始
        function startFortune() {
            let selectedCastle;
            
            if (currentMode === 'daily') {
                selectedCastle = getDailyCastle();
                todaysCastle = selectedCastle;
            } else {
                if (!canDrawGacha()) {
                    showGachaLimitMessage();
                    return;
                }
                selectedCastle = getRandomCastle();
                gachaCount++;
            }
            
            displayFortuneResult(selectedCastle);
        }

        // 日替わり城取得
        function getDailyCastle() {
            const now = new Date();
            const jstOffset = 9 * 60;
            const utc = now.getTime() + (now.getTimezoneOffset() * 60000);
            const jst = new Date(utc + (jstOffset * 60000));
            
            const year = jst.getFullYear();
            const month = jst.getMonth();
            const date = jst.getDate();
            
            const seed = year * 10000 + month * 100 + date;
            const index = seed % castleData.length;
            
            return castleData[index];
        }

        // ランダム城取得
        function getRandomCastle() {
            const index = Math.floor(Math.random() * castleData.length);
            return castleData[index];
        }

        // ガチャ上限メッセージ
        function showGachaLimitMessage() {
            const app = document.getElementById('app');
            app.innerHTML = `
                <div class="card">
                    <h2 style="color: #ff9999; text-align: center; margin-bottom: 20px;">📱 本日のガチャ終了</h2>
                    <div class="gacha-limit-warning">
                        今日はもうガチャを3回引きました！<br>
                        明日の朝にまた新しい運勢を占えます。<br><br>
                        「今日の城」はいつでも確認できますよ 🏯
                    </div>
                    <div class="button-group">
                        <button class="btn btn-outline" onclick="location.reload()">
                            🌅 今日の城を見る
                        </button>
                    </div>
                </div>
            `;
        }

        // 占い結果表示
        function displayFortuneResult(castle) {
            const tweetText = `今日の占いは【${castle.城名}】🏯 ${castle.キャッチ}`;
            const tweetUrl = `https://twitter.com/intent/tweet?text=${encodeURIComponent(tweetText)}&hashtags=${encodeURIComponent('マカミ占い,ゆるバース')}`;
            const voteUrl = "https://www.yurugp.jp/characters/4333";

            const canDraw = canDrawGacha();

            const resultHTML = `
                <div class="card fortune-result">
                    <div class="castle-name">${castle.城名}</div>
                    
                    <div class="fortune-details">
                        <div class="detail-item">
                            <span class="detail-label">🏴 武将</span>
                            <span class="detail-value">${castle.武将}</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">🍱 ラッキーフード</span>
                            <span class="detail-value">${castle.フード}</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">🎨 ラッキーカラー</span>
                            <span class="detail-value">${castle.カラー}</span>
                        </div>
                    </div>
                    
                    <div class="catch-phrase">${castle.キャッチ}</div>
                    <div class="description">${castle.説明}</div>
                    
                    ${currentMode === 'random' ? `
                        <div class="gacha-counter">
                            <div class="gacha-counter-text">今日のガチャ: ${gachaCount}/3回</div>
                        </div>
                    ` : ''}
                    
                    <div class="button-group">
                        <a href="${tweetUrl}" target="_blank" class="btn btn-primary">
                            🐦 Xでシェア
                        </a>
                        <a href="${voteUrl}" target="_blank" class="btn btn-secondary">
                            👑 マカミに投票
                        </a>
                        ${canDraw ? `
                            <button class="btn btn-outline" onclick="drawAnotherCastle()">
                                🎲 別の城で占う
                            </button>
                        ` : `
                            <button class="btn btn-disabled" disabled>
                                🎲 本日のガチャ終了 (3/3)
                            </button>
                        `}
                        ${currentMode === 'random' && todaysCastle ? 
                            '<button class="btn btn-outline" onclick="showTodaysCastle()">🌅 今日の城に戻る</button>' : ''}
                    </div>
                    
                    ${!canDraw ? `
                        <div class="gacha-limit-warning">
                            明日の朝にガチャ回数がリセットされます
                        </div>
                    ` : ''}
                </div>
            `;
            
            document.getElementById('app').innerHTML = resultHTML;
        }

        // 別の城で占う
        function drawAnotherCastle() {
            if (!canDrawGacha()) {
                showGachaLimitMessage();
                return;
            }
            const castle = getRandomCastle();
            gachaCount++;
            displayFortuneResult(castle);
        }

        // 今日の城に戻る
        function showTodaysCastle() {
            if (todaysCastle) {
                displayFortuneResult(todaysCastle);
            }
        }

        // 初期化
        window.addEventListener('load', function() {
            console.log('マカミ占いアプリが起動しました - 日本名城50選版');
            console.log(`城データ数: ${castleData.length}城`);
        });
    </script>
</body>
</html>
