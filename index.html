<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>マカミ占い🏯</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: #ffffff;
            min-height: 100vh;
            line-height: 1.6;
        }
        
        .container {
            max-width: 400px;
            margin: 0 auto;
            padding: 20px;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .header h1 {
            font-size: 28px;
            margin-bottom: 10px;
            background: linear-gradient(45deg, #ffd700, #ffeb3b);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .header p {
            color: #cccccc;
            font-size: 14px;
        }
        
        .card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 20px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }
        
        .fortune-result {
            text-align: center;
        }
        
        .castle-name {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 20px;
            color: #ffd700;
        }
        
        .fortune-details {
            margin-bottom: 20px;
        }
        
        .detail-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 12px;
            padding: 8px 12px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
        }
        
        .detail-label {
            font-weight: bold;
            color: #cccccc;
        }
        
        .detail-value {
            color: #ffffff;
        }
        
        .catch-phrase {
            font-size: 18px;
            font-weight: bold;
            color: #ffd700;
            margin: 20px 0 15px;
            text-align: center;
        }
        
        .description {
            color: #e0e0e0;
            font-size: 14px;
            text-align: center;
            line-height: 1.5;
        }
        
        .button-group {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-top: 20px;
        }
        
        .btn {
            padding: 15px 20px;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
            text-align: center;
        }
        
        .btn-primary {
            background: linear-gradient(45deg, #ff6b6b, #ee5a24);
            color: white;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(255, 107, 107, 0.4);
        }
        
        .btn-secondary {
            background: linear-gradient(45deg, #3742fa, #2f3542);
            color: white;
        }
        
        .btn-secondary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(55, 66, 250, 0.4);
        }
        
        .btn-outline {
            background: transparent;
            border: 2px solid #ffd700;
            color: #ffd700;
        }
        
        .btn-outline:hover {
            background: #ffd700;
            color: #1a1a2e;
        }
        
        .btn-disabled {
            background: #666;
            color: #aaa;
            cursor: not-allowed;
            border: 2px solid #666;
        }
        
        .btn-disabled:hover {
            transform: none;
            box-shadow: none;
            background: #666;
            color: #aaa;
        }
        
        .mode-selector {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .mode-btn {
            flex: 1;
            padding: 12px;
            border: 2px solid #ffd700;
            background: transparent;
            color: #ffd700;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
        }
        
        .mode-btn.active {
            background: #ffd700;
            color: #1a1a2e;
        }

        .initial-screen {
            text-align: center;
        }

        .start-btn {
            margin-top: 20px;
        }
        
        .gacha-counter {
            text-align: center;
            margin-bottom: 15px;
            padding: 10px;
            background: rgba(255, 215, 0, 0.1);
            border-radius: 10px;
            border: 1px solid rgba(255, 215, 0, 0.3);
        }
        
        .gacha-counter-text {
            color: #ffd700;
            font-size: 14px;
        }
        
        .gacha-limit-warning {
            color: #ff9999;
            font-size: 12px;
            text-align: center;
            margin-top: 10px;
            padding: 8px;
            background: rgba(255, 153, 153, 0.1);
            border-radius: 8px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🏯 マカミ占い 🏯</h1>
            <p>今日はどの城があなたを守ってくれる？</p>
        </div>
        
        <div id="app">
            <div class="card initial-screen">
                <h2 style="margin-bottom: 20px; color: #ffd700;">占いモードを選択</h2>
                <div class="mode-selector">
                    <button class="mode-btn active" onclick="setMode('daily')">今日の城</button>
                    <button class="mode-btn" onclick="setMode('random')">ランダム</button>
                </div>
                <div id="gacha-counter-display" style="display: none;">
                    <div class="gacha-counter">
                        <div class="gacha-counter-text">今日のガチャ: <span id="gacha-count">0</span>/3回</div>
                    </div>
                </div>
                <button class="btn btn-primary start-btn" onclick="startFortune()">占いを始める</button>
            </div>
        </div>
    </div>

    <script>
        // アプリの状態
        let currentMode = 'daily';
        let todaysCastle = null;
        let gachaCount = 0; // メモリ内でガチャ回数を管理

        // 100城完全データ
        const castleData = [
            {id: 1, 城名: "弘前城", 武将: "津軽為信", フード: "りんごパイ", カラー: "桜ピンク", キャッチ: "甘酸っぱさで恋も運も実るかも？", 説明: "弘前城は桜の名所。青森はりんごの産地で、城下にはりんごスイーツが豊富。"},
            {id: 2, 城名: "根城", 武将: "南部氏", フード: "ヨーグルト", カラー: "牧場ホワイト", キャッチ: "乳酸菌で腸から整えて快調スタート！", 説明: "中世の南部氏の本拠。酪農が盛んで乳製品も地域名物。"},
            {id: 3, 城名: "盛岡城", 武将: "南部信直", フード: "わんこそば", カラー: "岩手グレー", キャッチ: "食べ続ける根性が運を切り開く！", 説明: "巨大な花崗岩の石垣が圧巻。わんこそば文化が観光客にも人気。"},
            {id: 4, 城名: "多賀城", 武将: "大野東人", フード: "ずんだ餅", カラー: "みちのくグリーン", キャッチ: "豆パワーでコツコツ積み上げ吉！", 説明: "奈良時代の行政拠点。宮城名物のずんだは鮮やかな緑が目印。"},
            {id: 5, 城名: "山形城", 武将: "最上義光", フード: "さくらんぼ", カラー: "真っ赤レッド", キャッチ: "甘酸っぱさで気分も急上昇！", 説明: "最上義光が改修した名城。山形はさくらんぼ王国として全国的に有名。"},
            {id: 6, 城名: "二本松城", 武将: "畠山氏", フード: "玉羊羹", カラー: "戦国ブラック", キャッチ: "プルンと弾む気持ちで幸運も弾む！", 説明: "「霞ヶ城」とも。丸い玉羊羹は独特の食べ方で親しまれる銘菓。"},
            {id: 7, 城名: "会津若松城", 武将: "蒲生氏郷", フード: "地酒", カラー: "赤瓦レッド", キャッチ: "ほろ酔い気分でアイデア湧く日！", 説明: "赤瓦が美しい名城。会津は酒どころとして蔵元が多い。"},
            {id: 8, 城名: "白河小峰城", 武将: "丹羽長重", フード: "白河ラーメン", カラー: "澄み切りブルー", キャッチ: "熱い一杯がやる気を後押し！", 説明: "石垣が美しい平山城。手打ち縮れ麺の白河ラーメンが名物。"},
            {id: 9, 城名: "水戸城", 武将: "徳川斉昭", フード: "干しいも", カラー: "納豆ブラウン", キャッチ: "粘りが勝利を呼び込む！", 説明: "水戸徳川家の居城。茨城は納豆・干しいもの名産地。"},
            {id: 10, 城名: "足利氏館", 武将: "足利尊氏", フード: "シュウマイ", カラー: "武家ブラック", キャッチ: "将軍パワーで天下取り気分！", 説明: "足利氏発祥の地で現在は寺院。歴史の層が厚い。"},
            {id: 11, 城名: "箕輪城", 武将: "長野業正", フード: "焼きまんじゅう", カラー: "関東グリーン", キャッチ: "甘ダレの力で人望もアップ！", 説明: "関東屈指の中世山城。焼きまんじゅうは群馬のソウルフード。"},
            {id: 12, 城名: "金山城", 武将: "由良氏", フード: "焼きまんじゅう", カラー: "金山ゴールド", キャッチ: "黄金オーラで注目度UP！", 説明: "石垣造りの山城。名前の縁起から「金運の城」としても人気。"},
            {id: 13, 城名: "鉢形城", 武将: "北条氏邦", フード: "川越いも菓子", カラー: "小江戸パープル", キャッチ: "ほっこり甘さで心も票もほぐれる！", 説明: "荒川沿いの大規模平山城。川越は芋スイーツの街。"},
            {id: 14, 城名: "川越城", 武将: "松平信綱", フード: "芋ようかん", カラー: "城下イエロー", キャッチ: "ねっとり甘さで人の心をつかむ！", 説明: "「小江戸」川越の中心。城下町と芋スイーツが名物。"},
            {id: 15, 城名: "佐倉城", 武将: "堀田正信", フード: "落花生", カラー: "千葉グリーン", キャッチ: "コリッと噛んで集中力UP！", 説明: "土塁と空堀が見どころ。千葉は落花生の一大産地。"},
            {id: 16, 城名: "江戸城", 武将: "徳川家康", フード: "にぎり寿司", カラー: "江戸紫", キャッチ: "天下人の気分で一歩リード！", 説明: "徳川幕府の中枢。江戸前寿司は都市文化の象徴。"},
            {id: 17, 城名: "八王子城", 武将: "北条氏照", フード: "桑の実団子", カラー: "多摩グリーン", キャッチ: "山のパワーで積み重ね吉！", 説明: "堅固な山城。多摩地域は果樹や農産物も豊富。"},
            {id: 18, 城名: "小田原城", 武将: "北条早雲", フード: "かまぼこ", カラー: "相模ブルー", キャッチ: "プリッと弾力で運気も弾む！", 説明: "北条氏の本拠。小田原かまぼこは定番土産。"},
            {id: 19, 城名: "武田氏館", 武将: "武田信玄", フード: "ほうとう", カラー: "赤備えレッド", キャッチ: "麺をすすれば勝率アップ！", 説明: "甲斐武田の居館跡。山梨の郷土料理ほうとうが名物。"},
            {id: 20, 城名: "甲府城", 武将: "加藤光泰", フード: "甲州ワイン", カラー: "ブドウパープル", キャッチ: "グラス一杯で心も華やぐ！", 説明: "甲府盆地を望む平山城。山梨は日本ワインの名産地。"},
            {id: 21, 城名: "松代城", 武将: "真田信之", フード: "長芋とろろ", カラー: "六文銭レッド", キャッチ: "粘り勝ちでラストスパート！", 説明: "真田家ゆかりの城。長芋は滋養に富み郷土食として定着。"},
            {id: 22, 城名: "上田城", 武将: "真田昌幸", フード: "地酒", カラー: "真田レッド", キャッチ: "乾杯の勢いで突破できる日！", 説明: "徳川軍を二度退けた名城。酒蔵が点在し地酒が人気。"},
            {id: 23, 城名: "小諸城", 武将: "仙石秀久", フード: "くるみおはぎ", カラー: "浅間グレー", キャッチ: "コロコロ丸めて運気も上向き！", 説明: "城下より低い位置の「穴城」。くるみおはぎは素朴な甘さ。"},
            {id: 24, 城名: "松本城", 武将: "石川数正", フード: "おやき", カラー: "烏城ブラック", キャッチ: "皮の中に意外な幸運が隠れてる！", 説明: "黒漆の外観が美しく「烏城」とも。信州おやきは具が多彩。"},
            {id: 25, 城名: "高遠城", 武将: "武田勝頼", フード: "高遠そば", カラー: "桜ピンク", キャッチ: "花より団子、いや今日はそば！", 説明: "桜の名所。辛味大根を使う高遠そばが名物。"},
            {id: 26, 城名: "新発田城", 武将: "溝口秀勝", フード: "コシヒカリ", カラー: "雪ホワイト", キャッチ: "白米パワーで白星ゲット！", 説明: "三つ鯱が珍しい城。新潟は米どころとして有名。"},
            {id: 27, 城名: "春日山城", 武将: "上杉謙信", フード: "日本酒", カラー: "義のブルー", キャッチ: "義の心で清き一日！", 説明: "上杉謙信の本拠。越後は名だたる酒どころ。"},
            {id: 28, 城名: "高岡城", 武将: "前田利長", フード: "ます寿司", カラー: "加賀グリーン", キャッチ: "押し寿司みたいに運気もギュッ！", 説明: "加賀藩ゆかりの城。富山名物のます寿司は定番土産。"},
            {id: 29, 城名: "七尾城", 武将: "畠山義総", フード: "能登牡蠣", カラー: "日本海ブルー", キャッチ: "海の幸で潮目が変わる！", 説明: "能登の山城。濃厚な能登牡蠣は冬の味覚。"},
            {id: 30, 城名: "金沢城", 武将: "前田利家", フード: "金箔ソフト", カラー: "ゴールド", キャッチ: "輝きすぎ注意、でも今日は光る！", 説明: "加賀百万石の象徴。金箔産業でも全国的に有名。"},
            {id: 31, 城名: "丸岡城", 武将: "柴田勝豊", フード: "越前そば", カラー: "石瓦グレー", キャッチ: "ズルッとすすってツルッと勝利！", 説明: "現存最古の天守。おろしそばがご当地スタイル。"},
            {id: 32, 城名: "一乗谷朝倉氏遺跡", 武将: "朝倉義景", フード: "鯖寿司", カラー: "戦国ブルー", キャッチ: "滅びてもまた立ち上がる底力！", 説明: "戦国大名・朝倉氏の城下町跡。往時の町並みが復元。"},
            {id: 33, 城名: "岩村城", 武将: "遠山景任", フード: "女城主ワイン", カラー: "山城グリーン", キャッチ: "標高に負けず運気上昇！", 説明: "女城主で知られる山城。恵那はワイン造りも盛ん。"},
            {id: 34, 城名: "岐阜城", 武将: "織田信長", フード: "鮎菓子", カラー: "天下布武ゴールド", キャッチ: "信長の勢いで一気に行く！", 説明: "信長が天下布武を掲げた舞台。長良川の鮎が名物。"},
            {id: 35, 城名: "山中城", 武将: "北条氏", フード: "わさび漬け", カラー: "障子堀グリーン", キャッチ: "ピリッと刺激で眠気も飛ぶ！", 説明: "畝堀（障子堀）が有名。静岡はわさび漬けの名産地。"},
            {id: 36, 城名: "駿府城", 武将: "徳川家康", フード: "静岡おでん", カラー: "茶畑グリーン", キャッチ: "濃いお茶で心は静かに、行動は熱く！", 説明: "家康の隠居城。黒はんぺんの静岡おでんが名物。"},
            {id: 37, 城名: "掛川城", 武将: "山内一豊", フード: "掛川茶", カラー: "お茶グリーン", キャッチ: "一服で心も整い運も整う！", 説明: "東海道の要衝。掛川は高品質なお茶の産地。"},
            {id: 38, 城名: "浜松城", 武将: "徳川家康", フード: "浜松餃子", カラー: "勝ち運ブラック", キャッチ: "円形に集まれば運も集まる！", 説明: "家康ゆかりの城。もやしを添える浜松餃子が有名。"},
            {id: 39, 城名: "長篠城", 武将: "奥平信昌", フード: "鳶ヶ巣鍋", カラー: "鉄砲グレー", キャッチ: "火縄銃のごとく連射で前進！", 説明: "長篠の戦いで知られる。郷土料理の鳶ヶ巣鍋も。"},
            {id: 40, 城名: "岡崎城", 武将: "徳川家康", フード: "八丁味噌田楽", カラー: "味噌ブラウン", キャッチ: "コクのある一日で勝利を呼ぶ！", 説明: "家康生誕地。400年以上の歴史を持つ八丁味噌。"},
            {id: 41, 城名: "名古屋城", 武将: "徳川義直", フード: "エビフライ", カラー: "金シャチゴールド", キャッチ: "サクッと軽やかに運気も跳ねる！", 説明: "金の鯱で象徴的。名古屋めしの代表がエビフライ。"},
            {id: 42, 城名: "大垣城", 武将: "戸田氏鉄", フード: "水まんじゅう", カラー: "水ブルー", キャッチ: "プルプル冷んやり、気分爽快！", 説明: "水の都の平城。夏の水まんじゅうが名菓。"},
            {id: 43, 城名: "伊賀上野城", 武将: "藤堂高虎", フード: "忍者だんご", カラー: "忍ブラック", キャッチ: "忍んで動いて結果はド派手！", 説明: "高虎の名城。伊賀は忍者の里として人気。"},
            {id: 44, 城名: "松阪城", 武将: "蒲生氏郷", フード: "松阪牛", カラー: "肉レッド", キャッチ: "がっつり食べてエネルギー満タン！", 説明: "氏郷が築城。全国区のブランド牛で知られる。"},
            {id: 45, 城名: "津城", 武将: "藤堂高虎", フード: "伊勢うどん", カラー: "伊勢ブラック", キャッチ: "ふにゃ麺で今日も柔軟に！", 説明: "高虎の代表作。太麺×濃いつゆがご当地流。"},
            {id: 46, 城名: "小谷城", 武将: "浅井長政", フード: "鮒寿司", カラー: "戦国ブルー", キャッチ: "発酵の力でじわじわ成果！", 説明: "浅井氏の居城。琵琶湖の発酵食・鮒寿司が名物。"},
            {id: 47, 城名: "彦根城", 武将: "井伊直政", フード: "ひこにゃん焼き", カラー: "赤備えレッド", キャッチ: "甘いもので心も丸く収まる！", 説明: "国宝五城の一つ。ご当地キャラ関連の菓子が人気。"},
            {id: 48, 城名: "安土城", 武将: "織田信長", フード: "近江牛コロッケ", カラー: "天下布武ゴールド", キャッチ: "サクッと揚げて天下気分！", 説明: "信長の理想を体現した城跡。近江牛は滋賀の誇り。"},
            {id: 49, 城名: "観音寺城", 武将: "六角義賢", フード: "近江ちゃんぽん", カラー: "湖国ブルー", キャッチ: "混ざり合う味のように多様性が力に！", 説明: "六角氏の本拠。野菜たっぷりのご当地麺。"},
            {id: 50, 城名: "二条城", 武将: "徳川家康", フード: "八ツ橋", カラー: "京紫", キャッチ: "シナモンの香りで人を惹きつける！", 説明: "将軍上洛の宿所。京都銘菓・八ツ橋は定番。"},
            {id: 51, 城名: "大阪城", 武将: "豊臣秀吉", フード: "たこ焼き", カラー: "金ピカゴールド", キャッチ: "熱々の勢いでチャンスを掴め！", 説明: "秀吉の象徴。たこ焼きは大阪のソウルフード。"},
            {id: 52, 城名: "千早城", 武将: "楠木正成", フード: "葛きり", カラー: "山岳グリーン", キャッチ: "コシの強さで逆境にも勝てる！", 説明: "難攻不落で知られる。吉野名産の葛が名物。"},
            {id: 53, 城名: "明石城", 武将: "小笠原忠真", フード: "明石焼き", カラー: "瀬戸内ブルー", キャッチ: "出汁に浸かって心もとろける！", 説明: "譜代小笠原氏の城。玉子生地×出汁の明石焼き。"},
            {id: 54, 城名: "篠山城", 武将: "松平康重", フード: "ぼたん鍋", カラー: "丹波ブラウン", キャッチ: "野生の力で勝負強さUP！", 説明: "家康が築かせた城。猪鍋（ぼたん鍋）が冬の名物。"},
            {id: 55, 城名: "姫路城", 武将: "池田輝政", フード: "アーモンドトースト", カラー: "白鷺ホワイト", キャッチ: "軽やかに舞えば今日の主役！", 説明: "白鷺城の別名を持つ国宝。喫茶モーニング文化も有名。"},
            {id: 56, 城名: "赤穂城", 武将: "浅野長直", フード: "赤穂の塩", カラー: "しおホワイト", キャッチ: "一振りで味が決まる決断力！", 説明: "赤穂浪士ゆかり。塩の産地として歴史的に著名。"},
            {id: 57, 城名: "岡山城", 武将: "宇喜多秀家", フード: "きびだんご", カラー: "烏城ブラック", キャッチ: "仲間を集めれば百人力！", 説明: "黒い外観から烏城。桃太郎伝説で名高いきびだんご。"},
            {id: 58, 城名: "備中松山城", 武将: "小堀正次", フード: "柚べし", カラー: "雲海ホワイト", キャッチ: "雲の上の気分で視野が広がる！", 説明: "現存天守の山城。雲海に浮かぶ姿が幻想的。"},
            {id: 59, 城名: "福山城", 武将: "水野勝成", フード: "鯛めし", カラー: "備後ブルー", キャッチ: "パッと華やかに人目を集める！", 説明: "譜代の要。瀬戸内の鯛は祝い事の縁起物。"},
            {id: 60, 城名: "吉田郡山城", 武将: "毛利元就", フード: "あなご飯", カラー: "戦国グレー", キャッチ: "一本釣りで狙い逃さず！", 説明: "元就の本拠。宮島名物のあなご飯が有名。"},
            {id: 61, 城名: "広島城", 武将: "毛利輝元", フード: "お好み焼き", カラー: "カープレッド", キャッチ: "重ねて積み上げ成果も増える！", 説明: "「鯉城」とも。重ね焼きスタイルのお好み焼き。"},
            {id: 62, 城名: "岩国城", 武将: "吉川広家", フード: "れんこん料理", カラー: "錦帯橋ブラウン", キャッチ: "穴から未来をのぞけばヒントあり！", 説明: "錦帯橋と並ぶ名所。岩国れんこんが名産。"},
            {id: 63, 城名: "萩城", 武将: "毛利輝元", フード: "夏みかん", カラー: "シトラスオレンジ", キャッチ: "爽やかに動けば人気急上昇！", 説明: "指月山麓の城。夏みかん栽培の発祥地として知られる。"},
            {id: 64, 城名: "徳島城", 武将: "蜂須賀家政", フード: "フィッシュカツ", カラー: "阿波ブルー", キャッチ: "パンチの効いた一撃が運を呼ぶ！", 説明: "阿波蜂須賀氏の居城。B級グルメが人気。"},
            {id: 65, 城名: "高松城", 武将: "生駒親正", フード: "讃岐うどん", カラー: "瀬戸内ブルー", キャッチ: "コシの強さでやり抜く！", 説明: "日本三大水城の一つ。香川はうどん県として全国区。"},
            {id: 66, 城名: "丸亀城", 武将: "生駒一正", フード: "骨付鳥", カラー: "石垣グレー", キャッチ: "ガブリとかみつきチャンス到来！", 説明: "日本一高い石垣。骨付鳥は市発祥の名物。"},
            {id: 67, 城名: "今治城", 武将: "藤堂高虎", フード: "みかん", カラー: "瀬戸内オレンジ", キャッチ: "ビタミンで元気モリモリ！", 説明: "三大水城のひとつ。愛媛は柑橘の名産地。"},
            {id: 68, 城名: "松山城", 武将: "加藤嘉明", フード: "坊っちゃん団子", カラー: "道後グリーン", キャッチ: "甘さで心がとろける！", 説明: "現存建造物が多い名城。小説ゆかりの団子が名菓。"},
            {id: 69, 城名: "大洲城", 武将: "加藤貞泰", フード: "いもたき", カラー: "肱川ブルー", キャッチ: "ほっこり温まって優しさ広がる！", 説明: "復元天守を持つ。河原の「いもたき」は秋の風物詩。"},
            {id: 70, 城名: "宇和島城", 武将: "伊達宗利", フード: "鯛めし", カラー: "宇和海ブルー", キャッチ: "豪快に食べて豪快に勝つ！", 説明: "現存天守の城。宇和島流は生卵×醤油ダレが特徴。"},
            {id: 71, 城名: "高知城", 武将: "山内一豊", フード: "カツオのたたき", カラー: "土佐レッド", キャッチ: "叩けば叩くほど味が出る！", 説明: "山内家の居城。藁焼きの香ばしさが名物。"},
            {id: 72, 城名: "福岡城", 武将: "黒田長政", フード: "もつ鍋", カラー: "博多ブラック", キャッチ: "コク深い縁がつながる予感！", 説明: "九州最大級の城郭。冬の定番・もつ鍋が人気。"},
            {id: 73, 城名: "大野城", 武将: "大伴旅人", フード: "梅ヶ枝餅", カラー: "太宰府ピンク", キャッチ: "焼きたての勢いで気持ちも熱く！", 説明: "古代山城。太宰府天満宮の名物餅が参拝客に人気。"},
            {id: 74, 城名: "名護屋城", 武将: "豊臣秀吉", フード: "呼子のイカ", カラー: "玄界灘ブルー", キャッチ: "透明感ある行動で信頼度UP！", 説明: "朝鮮出兵の拠点。呼子のイカは透き通る身が名物。"},
            {id: 75, 城名: "吉野ヶ里遺跡", 武将: "弥生人", フード: "麦飯", カラー: "土器ブラウン", キャッチ: "古代パワーで意外な人気が出る！", 説明: "弥生時代の環濠集落。体験施設としても人気。"},
            {id: 76, 城名: "佐賀城", 武将: "鍋島直茂", フード: "シシリアンライス", カラー: "佐賀ホワイト", キャッチ: "盛り盛りで気持ちも盛り上がる！", 説明: "「沈み城」とも。ご飯×肉×野菜のB級グルメ。"},
            {id: 77, 城名: "平戸城", 武将: "松浦鎮信", フード: "カスドース", カラー: "オランダイエロー", キャッチ: "甘さで異国との縁も引き寄せる！", 説明: "南蛮貿易で栄えた港町。砂糖菓子文化が残る。"},
            {id: 78, 城名: "島原城", 武将: "松倉重政", フード: "かんざらし", カラー: "雲仙ホワイト", キャッチ: "つるんと落ちて悩み解決！", 説明: "キリシタン史とも関わる城。冷やし白玉の郷土菓子。"},
            {id: 79, 城名: "熊本城", 武将: "加藤清正", フード: "いきなり団子", カラー: "からしレンコンイエロー", キャッチ: "不意打ちの行動が吉！", 説明: "清正が築いた巨城。素朴な郷土菓子が県民の味。"},
            {id: 80, 城名: "人吉城", 武将: "相良氏", フード: "球磨焼酎", カラー: "球磨ブルー", キャッチ: "グイッといけば迷いが消える！", 説明: "相良氏が長く治めた地。球磨焼酎の本場。"},
            {id: 81, 城名: "大分府内城", 武将: "福原直高", フード: "とり天", カラー: "別府ブルー", キャッチ: "サクサク進んで好調！", 説明: "海城として築かれた。大分名物のとり天が軽快。"},
            {id: 82, 城名: "岡城", 武将: "中川秀成", フード: "だんご汁", カラー: "滝廉太郎ブルー", キャッチ: "荒城の月のように光り輝け！", 説明: "「荒城の月」で知られる山城。郷土のだんご汁が温まる。"},
            {id: 83, 城名: "臼杵城", 武将: "大友宗麟", フード: "フグ料理", カラー: "城下ホワイト", キャッチ: "ちょっとスリルが運を呼ぶ！", 説明: "宗麟ゆかり。フグの本場として全国的に有名。"},
            {id: 84, 城名: "中津城", 武将: "細川忠興", フード: "唐揚げ", カラー: "耶馬渓グリーン", キャッチ: "サクサク軽快に進める日！", 説明: "細川氏・黒田氏ゆかり。唐揚げ専門店が多い地域。"},
            {id: 85, 城名: "小倉城", 武将: "細川忠興", フード: "ぬかみそ炊き", カラー: "紫川ブルー", キャッチ: "コトコト煮込んで深みが出る！", 説明: "細川・小笠原ゆかり。家庭の味・ぬかみそ炊き。"},
            {id: 86, 城名: "飫肥城", 武将: "伊東祐兵", フード: "厚焼き卵", カラー: "日南イエロー", キャッチ: "卵のようにふんわり丸く収まる！", 説明: "伊東氏の本拠。厚焼き卵や飫肥天が名物。"},
            {id: 87, 城名: "鹿児島城", 武将: "島津義弘", フード: "かるかん", カラー: "桜島グレー", キャッチ: "ふわっと優しくまとめ役に！", 説明: "島津氏の居城。蒸し菓子かるかんが郷土の味。"},
            {id: 88, 城名: "首里城", 武将: "尚氏王家", フード: "紅いもタルト", カラー: "琉球レッド", キャッチ: "鮮やかに彩れば人気集中！", 説明: "琉球王国の王城。紅いもタルトはお土産の定番。"},
            {id: 89, 城名: "中城城", 武将: "護佐丸", フード: "沖縄そば", カラー: "青い海ブルー", キャッチ: "のんびり気分でチャンス舞い込む！", 説明: "世界遺産のグスク群。沖縄そばは県民の味。"},
            {id: 90, 城名: "今帰仁城", 武将: "北山王", フード: "サーターアンダギー", カラー: "南国オレンジ", キャッチ: "甘さで人も運も集まる日！", 説明: "世界遺産の古城。素朴なドーナツが人気。"},
            {id: 91, 城名: "松前城", 武将: "松前氏", フード: "松前漬け", カラー: "津軽海峡ブルー", キャッチ: "ネバネバで縁をつなぐ！", 説明: "北海道唯一の日本式城郭。数の子×昆布の郷土料理。"},
            {id: 92, 城名: "五稜郭", 武将: "榎本武揚", フード: "函館塩ラーメン", カラー: "星形ホワイト", キャッチ: "星のようにキラッと輝く日！", 説明: "西洋式の稜堡。箱館戦争の舞台として著名。"},
            {id: 93, 城名: "根室半島チャシ跡群", 武将: "アイヌの勇士たち", フード: "鮭料理", カラー: "北の大地グリーン", キャッチ: "大自然の力で生命力アップ！", 説明: "アイヌの砦跡。鮭は生活文化の中心的食材。"},
            {id: 94, 城名: "津和野城", 武将: "吉見正頼", フード: "うずめ飯", カラー: "石州レッド", キャッチ: "隠れた具のようにサプライズ運！", 説明: "山陰の小京都を見下ろす山城。具を埋める独特の郷土食。"},
            {id: 95, 城名: "月山富田城", 武将: "尼子経久", フード: "しじみ汁", カラー: "出雲ブルー", キャッチ: "じんわり効いて底力が湧く！", 説明: "出雲を支配した尼子氏の本拠。宍道湖のしじみが名物。"},
            {id: 96, 城名: "鳥取城", 武将: "吉川経家", フード: "二十世紀梨", カラー: "砂丘ベージュ", キャッチ: "すっきり爽やかに進める日！", 説明: "籠城戦で知られる城跡。鳥取名産の青梨が人気。"},
            {id: 97, 城名: "米子城", 武将: "吉川広家", フード: "鬼太郎まんじゅう", カラー: "日本海ブルー", キャッチ: "ゆるキャラ相性バツグン！", 説明: "山陰の要。近隣の水木しげるロードが観光名所。"},
            {id: 98, 城名: "津山城", 武将: "森忠政", フード: "ホルモンうどん", カラー: "城東ホワイト", キャッチ: "がっつり食べてがっつり動ける！", 説明: "森忠政が築いた名城。B級グルメの聖地としても。"},
            {id: 99, 城名: "備中高松城", 武将: "清水宗治", フード: "マスカット", カラー: "水攻めブルー", キャッチ: "甘さと潤いで心もしっとり！", 説明: "秀吉の水攻めで有名。岡山はマスカットの産地。"},
            {id: 100, 城名: "岡豊城", 武将: "長宗我部元親", フード: "文旦", カラー: "土佐オレンジ", キャッチ: "豪快に振る舞えば人気爆上げ！", 説明: "長宗我部氏の本拠。文旦は香り高い土佐果実。"}
        ];

        // ガチャ回数管理（メモリベース）
        function canDrawGacha() {
            return gachaCount < 3;
        }

        function updateGachaDisplay() {
            const countElement = document.getElementById('gacha-count');
            if (countElement) {
                countElement.textContent = gachaCount;
            }
        }

        // モード設定
        function setMode(mode) {
            currentMode = mode;
            document.querySelectorAll('.mode-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            // ランダムモードの時だけガチャカウンター表示
            const gachaDisplay = document.getElementById('gacha-counter-display');
            if (mode === 'random') {
                gachaDisplay.style.display = 'block';
                updateGachaDisplay();
            } else {
                gachaDisplay.style.display = 'none';
            }
        }

        // 占い開始
        function startFortune() {
            let selectedCastle;
            
            if (currentMode === 'daily') {
                selectedCastle = getDailyCastle();
                todaysCastle = selectedCastle;
            } else {
                if (!canDrawGacha()) {
                    showGachaLimitMessage();
                    return;
                }
                selectedCastle = getRandomCastle();
                gachaCount++;
            }
            
            displayFortuneResult(selectedCastle);
        }

        // 日替わり城取得（日本時間基準）
        function getDailyCastle() {
            const now = new Date();
            const jstOffset = 9 * 60; // JST = UTC+9
            const utc = now.getTime() + (now.getTimezoneOffset() * 60000);
            const jst = new Date(utc + (jstOffset * 60000));
            
            const year = jst.getFullYear();
            const month = jst.getMonth();
            const date = jst.getDate();
            
            // 日付から固定シードを生成
            const seed = year * 10000 + month * 100 + date;
            const index = seed % castleData.length;
            
            return castleData[index];
        }

        // ランダム城取得
        function getRandomCastle() {
            const index = Math.floor(Math.random() * castleData.length);
            return castleData[index];
        }

        // ガチャ上限メッセージ
        function showGachaLimitMessage() {
            const app = document.getElementById('app');
            app.innerHTML = `
                <div class="card">
                    <h2 style="color: #ff9999; text-align: center; margin-bottom: 20px;">📱 本日のガチャ終了</h2>
                    <div class="gacha-limit-warning">
                        今日はもうガチャを3回引きました！<br>
                        明日の朝にまた新しい運勢を占えます。<br><br>
                        「今日の城」はいつでも確認できますよ 🏯
                    </div>
                    <div class="button-group">
                        <button class="btn btn-outline" onclick="location.reload()">
                            🌅 今日の城を見る
                        </button>
                    </div>
                </div>
            `;
        }

        // 占い結果表示
        function displayFortuneResult(castle) {
            const tweetText = `今日の占いは【${castle.城名}】🏯 ${castle.キャッチ}`;
            const tweetUrl = `https://twitter.com/intent/tweet?text=${encodeURIComponent(tweetText)}&hashtags=${encodeURIComponent('マカミ占い,ゆるバース')}`;
            const voteUrl = "https://www.yurugp.jp/"; // 実際の投票URLに差し替え

            const canDraw = canDrawGacha();

            const resultHTML = `
                <div class="card fortune-result">
                    <div class="castle-name">${castle.城名}</div>
                    
                    <div class="fortune-details">
                        <div class="detail-item">
                            <span class="detail-label">🏴 武将</span>
                            <span class="detail-value">${castle.武将}</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">🍱 ラッキーフード</span>
                            <span class="detail-value">${castle.フード}</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">🎨 ラッキーカラー</span>
                            <span class="detail-value">${castle.カラー}</span>
                        </div>
                    </div>
                    
                    <div class="catch-phrase">${castle.キャッチ}</div>
                    <div class="description">${castle.説明}</div>
                    
                    ${currentMode === 'random' ? `
                        <div class="gacha-counter">
                            <div class="gacha-counter-text">今日のガチャ: ${gachaCount}/3回</div>
                        </div>
                    ` : ''}
                    
                    <div class="button-group">
                        <a href="${tweetUrl}" target="_blank" class="btn btn-primary">
                            🐦 Xでシェア
                        </a>
                        <a href="${voteUrl}" target="_blank" class="btn btn-secondary">
                            👑 マカミに投票
                        </a>
                        ${canDraw ? `
                            <button class="btn btn-outline" onclick="drawAnotherCastle()">
                                🎲 別の城で占う
                            </button>
                        ` : `
                            <button class="btn btn-disabled" disabled>
                                🎲 本日のガチャ終了 (3/3)
                            </button>
                        `}
                        ${currentMode === 'random' && todaysCastle ? 
                            '<button class="btn btn-outline" onclick="showTodaysCastle()">🌅 今日の城に戻る</button>' : ''}
                    </div>
                    
                    ${!canDraw ? `
                        <div class="gacha-limit-warning">
                            明日の朝にガチャ回数がリセットされます
                        </div>
                    ` : ''}
                </div>
            `;
            
            document.getElementById('app').innerHTML = resultHTML;
        }

        // 別の城で占う
        function drawAnotherCastle() {
            if (!canDrawGacha()) {
                showGachaLimitMessage();
                return;
            }
            const castle = getRandomCastle();
            gachaCount++;
            displayFortuneResult(castle);
        }

        // 今日の城に戻る
        function showTodaysCastle() {
            if (todaysCastle) {
                displayFortuneResult(todaysCastle);
            }
        }

        // 初期化
        window.addEventListener('load', function() {
            console.log('マカミ占いアプリが起動しました - 100城バージョン');
        });
    </script>
</body>
</html>
